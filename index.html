<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Генератор идей</title>
</head>
<body style="margin:0;padding:20px;font-family:Arial,sans-serif">

<div style="max-width:600px;margin:0 auto">
  <div style="background:#000;color:#fff;padding:20px;border-radius:8px 8px 0 0">
    <h3 style="margin:0">Генератор идей</h3>
  </div>
  
  <div id="messages" style="background:#f7f7f7;height:400px;overflow-y:auto;padding:20px;border:1px solid #ddd">
    <div style="background:#fff;padding:12px;border-radius:8px;margin-bottom:10px">
      Привет. Я - генератор идей. Начнем
    </div>
  </div>
  
  <div style="background:#fff;padding:15px;border:1px solid #ddd;border-top:none">
    <input type="text" id="input" placeholder="Напишите ответ..." style="width:70%;padding:10px;border:1px solid #ddd;border-radius:5px">
    <button id="send" style="width:25%;padding:10px;background:#000;color:#fff;border:none;border-radius:5px;cursor:pointer">Отправить</button>
  </div>
  
  <div id="typing" style="display:none;padding:10px;color:#999">Генератор думает...</div>
</div>

<script>
const API='https://plainfrog-5107.torbichev.workers.dev';
let sid=localStorage.getItem('sid')||'s_'+Date.now();
localStorage.setItem('sid',sid);
const msgs=document.getElementById('messages');
const inp=document.getElementById('input');
const btn=document.getElementById('send');
const typ=document.getElementById('typing');

function add(txt,user){
  const d=document.createElement('div');
  d.style.cssText='padding:12px;border-radius:8px;margin-bottom:10px;'+(user?'background:#000;color:#fff;text-align:right':'background:#fff');
  d.textContent=txt;
  msgs.appendChild(d);
  msgs.scrollTop=msgs.scrollHeight;
}

async function send(){
  const msg=inp.value.trim();
  if(!msg)return;
  add(msg,true);
  inp.value='';
  typ.style.display='block';
  btn.disabled=true;
  try{
    const r=await fetch(API,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({chatInput:msg,sessionId:sid})});
    const d=await r.json();
    typ.style.display='none';
    add(d.response||'Ошибка',false);
  }catch(e){
    typ.style.display='none';
    add('Ошибка соединения',false);
  }
  btn.disabled=false;
}

btn.onclick=send;
inp.onkeypress=e=>{if(e.key=='Enter')send()};
</script>

</body>
</html>
